<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ACCC CSV 최적화 온라인 풀버전</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB86fhLyjTezPAfXW6Y1qPAZkDeyfoTmk8" async defer></script>
  <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js" async defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <style>body {margin:0;padding:0;} #map {width:100%; height:100vh;}
  #loginOverlay {position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;
  display:flex;flex-direction:column;align-items:center;justify-content:center;}
  </style>
</head>
<body>
<div id="loginOverlay">
  <h1>로그인</h1>
  <input id="email" placeholder="이메일"><br>
  <input id="password" type="password" placeholder="비밀번호"><br>
  <button onclick="login()">로그인</button>
</div>
<div id="map"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBlfuVwqrljZuY4ezuK48tF92E6Rddm_x0",
  authDomain: "spsaccc-3aecb.firebaseapp.com",
  projectId: "spsaccc-3aecb",
  storageBucket: "spsaccc-3aecb.appspot.com",
  messagingSenderId: "1014353850429",
  appId: "1:1014353850429:web:84c6f2e6d005b12e33fa54"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById("loginOverlay").style.display = "none";
    init();
  }
});

function login() {
  const email = document.getElementById("email").value;
  const pw = document.getElementById("password").value;
  auth.signInWithEmailAndPassword(email, pw).catch(e => alert(e.message));
}

async function init() {
  const map = new google.maps.Map(document.getElementById("map"), {
    center: {lat:35.8, lng:127.7}, zoom:7
  });

  const res = await fetch("https://raw.githubusercontent.com/hyunq0812/SPS-ACCC/main/tesla_data.csv");
  let csvText = await res.text();
  if (csvText.charCodeAt(0) === 0xFEFF) csvText = csvText.slice(1);
  const rows = csvText.split('\n').map(line => line.split(','));

  const markers = [];
  for (let i=5; i<rows.length; i++) {
    const row = rows[i];
    const lat = parseFloat(row[12] ?? "");
    const lng = parseFloat(row[13] ?? "");
    if (!lat || !lng) continue;
    const marker = new google.maps.Marker({
      position: {lat, lng},
      map: map
    });
    markers.push(marker);
  }
  new markerClusterer.MarkerClusterer({ map, markers });
}
</script>
</body>
</html>
